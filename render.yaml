services:
  # TrinityChain Main Server - API + Dashboard Combined
  - type: web
    name: trinitychain
    runtime: rust
    plan: free
    region: oregon
    branch: main
    buildCommand: |
      # Build the React dashboard first with Tailwind CSS
      echo "Building React Dashboard..."
      cd dashboard
      npm install
      npm run build
      cd ..
      # Build the Rust API server (headless, production-ready)
      echo "Building Rust API Server..."
      cargo build --release --bin trinity-api
    startCommand: ./target/release/trinity-api
    envVars:
      - key: RUST_LOG
        value: info
      - key: PORT
        fromGroup: web
      - key: CORS_ORIGIN
        value: "*"
    healthCheckPath: /api/blockchain/stats
    disk:
      name: trinitychain-data
      mountPath: /opt/render/project/src
      sizeGB: 1
    autoDeploy: true

# The server serves both:
# - API endpoints at /api/*
# - React dashboard at / (from dashboard/dist via ServeDir)
#
# Dashboard will be accessible at: https://trinitychain.onrender.com
# API will be accessible at: https://trinitychain.onrender.com/api/*
#
# Note: trinity-api is the headless production server (no TUI)
# trinity-server has a TUI for local development only
